<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <meta name="description" content="A simple privacy oriented bootstrap hugo blog" />
  <meta name="keywords" content="hugo, simple, minimal, bootstrap, blog" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content="Hugo 0.68.3" />
  <link
    rel="stylesheet"
    type="text/css"
    href='https://iliathoughts.com/css/bootstrap.min.css'
  />
  <title>
    Ray Tracer
  </title>
  <nav class="navbar text-center sticky-top bg-white mt-2 mb-1">
    <a href="https://iliathoughts.com"
      ><span class="btn btn-sm btn-outline-primary">Home</span></a
    >
    <a href='https://iliathoughts.com/about'
      ><span class="btn btn-sm btn-outline-secondary">About</span></a
    >
    <a href='https://iliathoughts.com/posts'
      ><span class="btn btn-sm btn-outline-success">Blog</span></a
    >
    <a href='https://iliathoughts.com/tags'
      ><span class="btn btn-sm btn-outline-warning">Tags</span></a
    >
  </nav>
  
</head>
<body>
      <div id="content">


	<section class="container text-monospace text-justified mt-3">
	  <h2>Ray Tracer</h2>
	  <small class="text-secondary mb-5">Posted on January 1, 2020 | 1 minute read</small>

	  <p><p>My implementation of Chapters 1-15 of The Ray Tracer Challenge book by Jamis Buck. Implemented in C++ and compiled to WebAssembly.</p>
<p>Just select a scene description from the dropdown (or enter your own according to the style used in the book) and click &ldquo;go!&rdquo; to generate the render.</p>
<p>Let me know what you think. Code is available on my <a href="https://github.com/bezdomniy/graphics/tree/master/rayTracer">Github</a>. Let me know if you have any tips for me.</p>
<p>EDIT: If it doesn&rsquo;t run, please clear your cache. I messed up the http headers the first time I pushed this and the wasm module cache never expires&hellip; so if you ran the site previously it won&rsquo;t update.</p>
<!DOCTYPE HTML>
<html>
<script id="jsscript" src="/js/RayTracerv1.wasm.js"></script>
<body>
<textarea rows=15 cols=50 id="sceneTextArea">
</textarea>
<br>
    <select id="scenes" onChange="return setScene()">
        <option scene="0" value="Choose a scene">Choose a scene</option>
        <option scene="1" value="/rayTracerScenes/reflectionScene.yaml">Reflections</option>
        <option scene="1" value="/rayTracerScenes/tables.yaml">Table</option>
        <option scene="2" value="/rayTracerScenes/groups.yaml">Groups</option>
        <option scene="3" value="/rayTracerScenes/cylinders.yaml">Cylinders</option>
        <option scene="4" value="/rayTracerScenes/hippy.yaml">Hippy</option>
        <option scene="5" value="/rayTracerScenes/shadowPuppets.yaml">Shadow Puppets</option>
        <option scene="6" value="/rayTracerScenes/coverScene.yaml">Cover Scene</option>
        <option scene="7" value="/rayTracerScenes/christmas.yaml">Christmas</option>
    </select>
    <button id="gobutton">go!</button>
<br>
<button id="leftbutton">left</button>
<button id="rightbutton">right</button>
<br>
<canvas id="outCanvas"></canvas>
<script>
var goButton = document.getElementById("gobutton");
var leftButton = document.getElementById("leftbutton");
var rightButton = document.getElementById("rightbutton");
var textarea = document.getElementById("sceneTextArea");
Module['onRuntimeInitialized'] = function() {
console.log("loaded");
const runner = new Module.EmscriptenRunner();
function updateRender() {  
 if (!runner.done()) {
var i;
var bytes = runner.renderToRGBA();
const canvas = document.getElementById('outCanvas');
const ctx = canvas.getContext('2d');
ctx.canvas.width = runner.getWidth();
ctx.canvas.height = runner.getHeight();
const imageData = ctx.createImageData(ctx.canvas.width, ctx.canvas.height);
// Iterate through every pixel
for (let i = 0; i < imageData.data.length; i += 4) {
// Modify pixel data
imageData.data[i + 0] = bytes[i + 0]; // R value
imageData.data[i + 1] = bytes[i + 1]; // G value
imageData.data[i + 2] = bytes[i + 2]; // B value
imageData.data[i + 3] = 255; // A value
}
// Draw image data to the canvas
ctx.putImageData(imageData, 0, 0);
}
}
// const runner = new Module.EmscriptenRunner(textarea.value);
var t;
var updateTime= 33;
var repeatLeft = function (action) {
runner.moveLeft();
t = setTimeout(repeatLeft, updateTime);
}
var repeatRight = function (action) {
runner.moveRight();
t = setTimeout(repeatRight, updateTime);
}  
 goButton.addEventListener(
"click", function() {
runner.init(textarea.value);
let showImg = setInterval(updateRender, updateTime);
}
);
leftButton.addEventListener(
"mousedown", function() {
repeatLeft();
}
);
rightButton.addEventListener(
"mousedown", function() {
repeatRight();
}
);
leftButton.addEventListener(
"mouseup", function() {
clearTimeout(t);
}
);
rightButton.addEventListener(
"mouseup", function() {
clearTimeout(t);
}
);
};
function setScene(){
// find the dropdown
var ddl = document.getElementById("scenes");
// find the selected option
var selectedOption = ddl.options[ddl.selectedIndex];
// find the attribute value
var sceneValue = selectedOption.getAttribute("value");
// find the textbox
var textBox = document.getElementById("sceneTextArea");
fetch(sceneValue)
.then(response => response.text())
.then((data) => {
textBox.value = data
})
}
</script>
</body>
</html>
</p>

	  <code>tags:<span class='badge badge-dark'><a class='text-white' href='https://iliathoughts.com/tags/ray%20tracer'>ray tracer</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://iliathoughts.com/tags/ray%20tracer%20challenge'>ray tracer challenge</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://iliathoughts.com/tags/webassembly'>webassembly</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://iliathoughts.com/tags/emscripten'>emscripten</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://iliathoughts.com/tags/c&#43;&#43;'>C&#43;&#43;</a></span>
	  
	  </code>
	  <div class="container mt-2" id="comments">
	    
		<small class="mt-1">Please mail your comments to <a href="ilia.shibaev@protonmail.com">ilia.shibaev@protonmail.com</a></small><br>
	    
	  </div>
	</section>



      </div>
  </body><footer>
  <div class="container-fluid bg-dark text-white text-monospace text-center mt-4">
    <small> | Crafted using <a href="https://gohugo.io">Hugo</a></small>
  </div>
  
</footer>
</html>
